{"version":3,"file":"static/js/366.7b14bde6.chunk.js","mappings":"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","sources":["components/QRScanner.js","utils/qrCodeGenerator.js","pages/QRScannerPage.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\nimport jsQR from 'jsqr';\nimport { parseQRData } from '../utils/qrCodeGenerator';\nimport { attendanceAPI } from '../services/api';\nimport { toast } from 'react-toastify';\nimport './QRScanner.css';\n\nconst QRScanner = ({ eventId, onScanSuccess }) => {\n  const [scanning, setScanning] = useState(false);\n  const [result, setResult] = useState(null);\n  const videoRef = useRef(null);\n  const canvasRef = useRef(null);\n  const streamRef = useRef(null);\n\n  useEffect(() => {\n    return () => {\n      stopScanning();\n    };\n  }, []);\n\n  const startScanning = async () => {\n    try {\n      const stream = await navigator.mediaDevices.getUserMedia({\n        video: { facingMode: 'environment', width: { ideal: 1280 }, height: { ideal: 720 } }\n      });\n      \n      setScanning(true);\n      \n      // Use setTimeout to ensure state update and DOM render\n      setTimeout(() => {\n        if (videoRef.current) {\n          videoRef.current.srcObject = stream;\n          streamRef.current = stream;\n          \n          // Wait for video to be ready before scanning\n          videoRef.current.onloadedmetadata = () => {\n            videoRef.current.play().then(() => {\n              scanQRCode();\n            }).catch(err => {\n              toast.error('Failed to start camera');\n              console.error('Play error:', err);\n            });\n          };\n        }\n      }, 100);\n    } catch (error) {\n      toast.error('Camera access denied');\n      console.error('Camera error:', error);\n    }\n  };\n\n  const stopScanning = () => {\n    if (streamRef.current) {\n      streamRef.current.getTracks().forEach(track => track.stop());\n      streamRef.current = null;\n    }\n    setScanning(false);\n  };\n\n  const scanQRCode = () => {\n    if (!videoRef.current || !canvasRef.current) return;\n\n    const video = videoRef.current;\n    const canvas = canvasRef.current;\n    const context = canvas.getContext('2d');\n\n    if (video.readyState === video.HAVE_ENOUGH_DATA) {\n      canvas.width = video.videoWidth;\n      canvas.height = video.videoHeight;\n      context.drawImage(video, 0, 0, canvas.width, canvas.height);\n\n      const imageData = context.getImageData(0, 0, canvas.width, canvas.height);\n      const code = jsQR(imageData.data, imageData.width, imageData.height);\n\n      if (code) {\n        handleQRCodeDetected(code.data);\n        return;\n      }\n    }\n\n    if (streamRef.current) {\n      requestAnimationFrame(scanQRCode);\n    }\n  };\n\n  const handleQRCodeDetected = async (qrData) => {\n    stopScanning();\n    \n    const parsed = parseQRData(qrData);\n    \n    if (!parsed || parsed.type !== 'EVENT_TICKET') {\n      toast.error('Invalid QR code');\n      return;\n    }\n\n    if (eventId && parsed.eventId !== eventId) {\n      toast.error('QR code is for a different event');\n      return;\n    }\n\n    try {\n      const response = await attendanceAPI.markAttendance(parsed.registrationId);\n      \n      if (response.data.success) {\n        setResult({\n          success: true,\n          userName: response.data.userName,\n          eventName: response.data.eventName\n        });\n        toast.success('Attendance marked successfully!');\n        if (onScanSuccess) onScanSuccess(response.data);\n      } else {\n        toast.error(response.data.message || 'Already checked in');\n      }\n    } catch (error) {\n      toast.error('Failed to mark attendance');\n      console.error('Attendance error:', error);\n    }\n  };\n\n  return (\n    <div className=\"qr-scanner\">\n      <div className=\"scanner-header\">\n        <h3>Scan Event Ticket</h3>\n        {scanning && (\n          <button className=\"btn btn-secondary\" onClick={stopScanning}>\n            Stop Scanning\n          </button>\n        )}\n      </div>\n\n      {!result && (\n        <>\n          {!scanning ? (\n            <div className=\"scanner-start\">\n              <button className=\"btn btn-primary\" onClick={startScanning}>\n                Start Camera\n              </button>\n            </div>\n          ) : (\n            <div className=\"scanner-video-container\">\n              <video \n                ref={videoRef} \n                autoPlay \n                playsInline \n                muted\n              />\n              <canvas ref={canvasRef} style={{ display: 'none' }} />\n              <div className=\"scanner-overlay\">\n                <div className=\"scanner-frame\"></div>\n              </div>\n            </div>\n          )}\n        </>\n      )}\n\n      {result && (\n        <div className={`scan-result ${result.success ? 'success' : 'error'}`}>\n          {result.success ? (\n            <>\n              <div className=\"success-icon\">✓</div>\n              <h3>Check-in Successful!</h3>\n              <p><strong>{result.userName}</strong></p>\n              <p>{result.eventName}</p>\n            </>\n          ) : (\n            <>\n              <div className=\"error-icon\">✗</div>\n              <h3>Check-in Failed</h3>\n              <p>{result.message}</p>\n            </>\n          )}\n          <button \n            className=\"btn btn-primary\" \n            onClick={() => {\n              setResult(null);\n              startScanning();\n            }}\n          >\n            Scan Next\n          </button>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default QRScanner;\n","import QRCode from 'qrcode.react';\n\nexport const generateUserQRData = (userId) => {\n  return JSON.stringify({\n    type: 'USER_PROFILE',\n    userId: userId,\n    timestamp: Date.now()\n  });\n};\n\nexport const generateEventTicketQRData = (userId, eventId, registrationId) => {\n  return JSON.stringify({\n    type: 'EVENT_TICKET',\n    userId: userId,\n    eventId: eventId,\n    registrationId: registrationId,\n    timestamp: Date.now()\n  });\n};\n\nexport const parseQRData = (qrData) => {\n  try {\n    return JSON.parse(qrData);\n  } catch (error) {\n    return null;\n  }\n};\n","import React, { useState, useEffect } from 'react';\nimport { eventsAPI } from '../services/api';\nimport QRScanner from '../components/QRScanner';\nimport './QRScannerPage.css';\n\nconst QRScannerPage = () => {\n  const [events, setEvents] = useState([]);\n  const [selectedEvent, setSelectedEvent] = useState(null);\n  const [scanHistory, setScanHistory] = useState([]);\n\n  useEffect(() => {\n    loadEvents();\n  }, []);\n\n  const loadEvents = async () => {\n    try {\n      const response = await eventsAPI.getAll();\n      setEvents(response.data.events || []);\n    } catch (error) {\n      console.error('Error loading events:', error);\n    }\n  };\n\n  const handleScanSuccess = (data) => {\n    setScanHistory(prev => [{\n      ...data,\n      timestamp: new Date().toLocaleTimeString()\n    }, ...prev]);\n  };\n\n  return (\n    <div className=\"qr-scanner-page\">\n      <div className=\"container\">\n        <div className=\"page-header\">\n          <h1>QR Code Scanner</h1>\n          <p>Scan event tickets to mark attendance</p>\n        </div>\n\n        <div className=\"scanner-layout\">\n          <div className=\"scanner-section\">\n            <div className=\"event-selector\">\n              <label>Select Event:</label>\n              <select \n                value={selectedEvent || ''} \n                onChange={(e) => setSelectedEvent(e.target.value)}\n                className=\"form-select\"\n              >\n                <option value=\"\">All Events</option>\n                {events.map(event => (\n                  <option key={event._id} value={event._id}>\n                    {event.title}\n                  </option>\n                ))}\n              </select>\n            </div>\n\n            <QRScanner \n              eventId={selectedEvent} \n              onScanSuccess={handleScanSuccess}\n            />\n          </div>\n\n          <div className=\"history-section\">\n            <h3>Scan History</h3>\n            {scanHistory.length === 0 ? (\n              <div className=\"empty-history\">\n                <p>No scans yet</p>\n              </div>\n            ) : (\n              <div className=\"history-list\">\n                {scanHistory.map((scan, index) => (\n                  <div key={index} className=\"history-item\">\n                    <div className=\"history-icon\">✓</div>\n                    <div className=\"history-details\">\n                      <strong>{scan.userName}</strong>\n                      <p>{scan.eventName}</p>\n                      <span className=\"history-time\">{scan.timestamp}</span>\n                    </div>\n                  </div>\n                ))}\n              </div>\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default QRScannerPage;\n\r\n"],"names":["_ref","eventId","onScanSuccess","scanning","setScanning","useState","result","setResult","videoRef","useRef","canvasRef","streamRef","useEffect","stopScanning","startScanning","async","stream","navigator","mediaDevices","getUserMedia","video","facingMode","width","ideal","height","setTimeout","current","srcObject","onloadedmetadata","play","then","scanQRCode","catch","err","toast","error","console","getTracks","forEach","track","stop","canvas","context","getContext","readyState","HAVE_ENOUGH_DATA","videoWidth","videoHeight","drawImage","imageData","getImageData","code","jsQR","data","handleQRCodeDetected","requestAnimationFrame","parsed","qrData","JSON","parse","parseQRData","type","response","attendanceAPI","markAttendance","registrationId","success","userName","eventName","message","_jsxs","className","children","_jsx","onClick","_Fragment","ref","autoPlay","playsInline","muted","style","display","concat","QRScannerPage","events","setEvents","selectedEvent","setSelectedEvent","scanHistory","setScanHistory","loadEvents","eventsAPI","getAll","value","onChange","e","target","map","event","_id","title","QRScanner","prev","_objectSpread","timestamp","Date","toLocaleTimeString","length","scan","index"],"sourceRoot":""}