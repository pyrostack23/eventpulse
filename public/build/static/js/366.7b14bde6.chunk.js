"use strict";(self.webpackChunkeventpulse_frontend=self.webpackChunkeventpulse_frontend||[]).push([[366],{6366:(e,s,n)=>{n.r(s),n.d(s,{default:()=>h});var a=n(9379),r=n(5043),t=n(4505),c=n(7361),i=n.n(c);n(1614);var l=n(7503),d=n(579);const o=e=>{let{eventId:s,onScanSuccess:n}=e;const[a,c]=(0,r.useState)(!1),[o,h]=(0,r.useState)(null),u=(0,r.useRef)(null),m=(0,r.useRef)(null),v=(0,r.useRef)(null);(0,r.useEffect)(()=>()=>{j()},[]);const x=async()=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1280},height:{ideal:720}}});c(!0),setTimeout(()=>{u.current&&(u.current.srcObject=e,v.current=e,u.current.onloadedmetadata=()=>{u.current.play().then(()=>{N()}).catch(e=>{l.oR.error("Failed to start camera"),console.error("Play error:",e)})})},100)}catch(e){l.oR.error("Camera access denied"),console.error("Camera error:",e)}},j=()=>{v.current&&(v.current.getTracks().forEach(e=>e.stop()),v.current=null),c(!1)},N=()=>{if(!u.current||!m.current)return;const e=u.current,s=m.current,n=s.getContext("2d");if(e.readyState===e.HAVE_ENOUGH_DATA){s.width=e.videoWidth,s.height=e.videoHeight,n.drawImage(e,0,0,s.width,s.height);const a=n.getImageData(0,0,s.width,s.height),r=i()(a.data,a.width,a.height);if(r)return void y(r.data)}v.current&&requestAnimationFrame(N)},y=async e=>{j();const a=(e=>{try{return JSON.parse(e)}catch(s){return null}})(e);if(a&&"EVENT_TICKET"===a.type)if(s&&a.eventId!==s)l.oR.error("QR code is for a different event");else try{const e=await t.Oh.markAttendance(a.registrationId);e.data.success?(h({success:!0,userName:e.data.userName,eventName:e.data.eventName}),l.oR.success("Attendance marked successfully!"),n&&n(e.data)):l.oR.error(e.data.message||"Already checked in")}catch(r){l.oR.error("Failed to mark attendance"),console.error("Attendance error:",r)}else l.oR.error("Invalid QR code")};return(0,d.jsxs)("div",{className:"qr-scanner",children:[(0,d.jsxs)("div",{className:"scanner-header",children:[(0,d.jsx)("h3",{children:"Scan Event Ticket"}),a&&(0,d.jsx)("button",{className:"btn btn-secondary",onClick:j,children:"Stop Scanning"})]}),!o&&(0,d.jsx)(d.Fragment,{children:a?(0,d.jsxs)("div",{className:"scanner-video-container",children:[(0,d.jsx)("video",{ref:u,autoPlay:!0,playsInline:!0,muted:!0}),(0,d.jsx)("canvas",{ref:m,style:{display:"none"}}),(0,d.jsx)("div",{className:"scanner-overlay",children:(0,d.jsx)("div",{className:"scanner-frame"})})]}):(0,d.jsx)("div",{className:"scanner-start",children:(0,d.jsx)("button",{className:"btn btn-primary",onClick:x,children:"Start Camera"})})}),o&&(0,d.jsxs)("div",{className:"scan-result ".concat(o.success?"success":"error"),children:[o.success?(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"success-icon",children:"\u2713"}),(0,d.jsx)("h3",{children:"Check-in Successful!"}),(0,d.jsx)("p",{children:(0,d.jsx)("strong",{children:o.userName})}),(0,d.jsx)("p",{children:o.eventName})]}):(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)("div",{className:"error-icon",children:"\u2717"}),(0,d.jsx)("h3",{children:"Check-in Failed"}),(0,d.jsx)("p",{children:o.message})]}),(0,d.jsx)("button",{className:"btn btn-primary",onClick:()=>{h(null),x()},children:"Scan Next"})]})]})},h=()=>{const[e,s]=(0,r.useState)([]),[n,c]=(0,r.useState)(null),[i,l]=(0,r.useState)([]);(0,r.useEffect)(()=>{h()},[]);const h=async()=>{try{const e=await t.MT.getAll();s(e.data.events||[])}catch(e){console.error("Error loading events:",e)}};return(0,d.jsx)("div",{className:"qr-scanner-page",children:(0,d.jsxs)("div",{className:"container",children:[(0,d.jsxs)("div",{className:"page-header",children:[(0,d.jsx)("h1",{children:"QR Code Scanner"}),(0,d.jsx)("p",{children:"Scan event tickets to mark attendance"})]}),(0,d.jsxs)("div",{className:"scanner-layout",children:[(0,d.jsxs)("div",{className:"scanner-section",children:[(0,d.jsxs)("div",{className:"event-selector",children:[(0,d.jsx)("label",{children:"Select Event:"}),(0,d.jsxs)("select",{value:n||"",onChange:e=>c(e.target.value),className:"form-select",children:[(0,d.jsx)("option",{value:"",children:"All Events"}),e.map(e=>(0,d.jsx)("option",{value:e._id,children:e.title},e._id))]})]}),(0,d.jsx)(o,{eventId:n,onScanSuccess:e=>{l(s=>[(0,a.A)((0,a.A)({},e),{},{timestamp:(new Date).toLocaleTimeString()}),...s])}})]}),(0,d.jsxs)("div",{className:"history-section",children:[(0,d.jsx)("h3",{children:"Scan History"}),0===i.length?(0,d.jsx)("div",{className:"empty-history",children:(0,d.jsx)("p",{children:"No scans yet"})}):(0,d.jsx)("div",{className:"history-list",children:i.map((e,s)=>(0,d.jsxs)("div",{className:"history-item",children:[(0,d.jsx)("div",{className:"history-icon",children:"\u2713"}),(0,d.jsxs)("div",{className:"history-details",children:[(0,d.jsx)("strong",{children:e.userName}),(0,d.jsx)("p",{children:e.eventName}),(0,d.jsx)("span",{className:"history-time",children:e.timestamp})]})]},s))})]})]})]})})}}}]);
//# sourceMappingURL=366.7b14bde6.chunk.js.map